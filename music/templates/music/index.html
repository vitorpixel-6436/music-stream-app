{% extends 'music/base.html' %}
{% load static %}

{% block content %}
<section class="hero-section">
    <div class="hero-content text-center">
        <h1 class="hero-title">ðŸŽ¶ Music Discovery</h1>
        <p>Your premium personal streaming library</p>
        
        <form action="{% url 'music:index' %}" method="get" class="search-bar mt-4">
            <input type="text" name="q" value="{{ search_query }}" placeholder="Search tracks, artists, albums..." class="search-input">
            <button type="submit" class="btn">Search</button>
            {% if search_query %}
                <a href="{% url 'music:index' %}" class="btn" style="background: var(--danger); border-color: var(--danger);">Clear</a>
            {% endif %}
        </form>

        <!-- UX: Keyboard Shortcuts Info -->
        <div class="shortcuts-info mt-4" style="font-size: 0.85rem; opacity: 0.8;">
            <span class="me-3"><kbd class="bg-secondary" style="font-family: inherit;">Space</kbd> Play/Pause</span>
            <span><kbd class="bg-secondary" style="font-family: inherit;">M</kbd> Mute</span>
        </div>
    </div>
</section>

<section class="container-fluid py-5">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2>ðŸ”¥ {% if search_query %}Search Results{% else %}Recently Added{% endif %}</h2>
        
        <div class="filters d-flex gap-2">
            <form action="{% url 'music:index' %}" method="get" class="d-flex gap-2">
                <select name="artist" class="search-input" onchange="this.form.submit()" style="width: auto;">
                    <option value="">All Artists</option>
                    {% for artist in all_artists %}
                        <option value="{{ artist.id }}" {% if selected_artist == artist.id|stringformat:"s" %}selected{% endif %}>{{ artist.name }}</option>
                    {% endfor %}
                </select>
                
                <select name="sort" class="search-input" onchange="this.form.submit()" style="width: auto;">
                    <option value="-created_at" {% if sort_by == '-created_at' %}selected{% endif %}>Newest</option>
                    <option value="title" {% if sort_by == 'title' %}selected{% endif %}>A-Z</option>
                    <option value="-play_count" {% if sort_by == '-play_count' %}selected{% endif %}>Popular</option>
                </select>
            </form>
        </div>
    </div>

    <div class="track-grid">
        {% for track in music_files %}
            <div class="track-item" onclick="window.location.href='{% url 'music:player' track.pk %}'">
                <div class="track-image">
                    {% if track.cover_image %}
                        <img src="{{ track.cover_image.url }}" alt="{{ track.title }}" style="width: 100%; height: 100%; object-fit: cover; border-radius: 12px;">
                    {% else %}
                        <div style="font-size: 3rem; opacity: 0.3;">ðŸŽµ</div>
                    {% endif %}
                </div>
                <div class="track-content">
                    <h3 class="track-title" style="font-size: 1.1rem; margin-bottom: 5px;">{{ track.title }}</h3>
                    <p class="track-artist" style="opacity: 0.7; font-size: 0.9rem;">{{ track.artist.name }}</p>
                    <div class="track-actions mt-3">
                        <a href="{% url 'music:player' track.pk %}" class="btn btn-sm">Play Now</a>
                        <a href="{% url 'music:download' track.pk %}" class="btn btn-sm btn-outline" style="border: 1px solid var(--glass-border);">Download</a>
                    </div>
                </div>
            </div>
        {% empty %}
            <div class="col-12 text-center py-5">
                <p class="text-secondary">No tracks found matching your criteria.</p>
            </div>
        {% endfor %}
    </div>
</section>

<script>
    // UX: Welcome Toast
    document.addEventListener('DOMContentLoaded', () => {
        if (!localStorage.getItem('returning_user')) {
            setTimeout(() => {
                if (window.showToast) {
                    showToast('Welcome! ðŸŽ§ Use Space to play/pause, M to mute.', 'success');
                }
                localStorage.setItem('returning_user', 'true');
            }, 1000);
        }
    });
</script>
{% endblock %}
